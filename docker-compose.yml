version: '3'
services:
    mqtt:
        image: eclipse-mosquitto:latest
        container_name: mqtt
        restart: unless-stopped
        volumes:
            - ${MEDIABOX_PATH}/mqtt:/mosquitto
        ports:
            - 1883:1883
            - 9001:9001
        command: "mosquitto -c /mosquitto-no-auth.conf"
        environment:
            - TZ=${TIMEZONE}
        networks:
            - mediabox

    zigbee2mqtt:
        container_name: zigbee2mqtt
        depends_on:
            - mqtt
        privileged: true
        restart: unless-stopped
        image: koenkk/zigbee2mqtt:latest
        volumes:
            - ${MEDIABOX_PATH}/zigbee2mqtt:/app/data
            - /run/udev:/run/udev:ro
        ports:
            - 8082:8080
        environment:
            - TZ=${TIMEZONE}
        networks:
           - mediabox

    duplicati:
        image: ghcr.io/linuxserver/duplicati:latest
        container_name: duplicati
        environment:
            - PUID=1000
            - PGID=1000
            - TZ=${TIMEZONE}
        volumes:
            - ${MEDIABOX_PATH}/duplicati:/config
            - ${MEDIABOX_PATH}/duplicati/backups:/backups
            - ${MEDIABOX_PATH}:/source
        ports:
            - 8200:8200
        restart: unless-stopped
        networks:
            - mediabox

    sabnzbd:
        image: ghcr.io/linuxserver/sabnzbd:latest
        container_name: sabnzbd
        environment:
            - PUID=1000
            - PGID=1000
            - TZ=${TIMEZONE}
        volumes:
            - ${MEDIABOX_PATH}/sabnzbd:/config
            - /media/HDD/downloads:/downloads
            - /media/HDD/incomplete-downloads:/incomplete-downloads
            - ${MEDIABOX_PATH}/swag/etc:/swag-ssl
        ports:
            - 8081:8080
        restart: unless-stopped
        networks:
            - mediabox

    sonarr:
        image: ghcr.io/linuxserver/sonarr:latest
        container_name: sonarr
        environment:
            - PUID=1000
            - PGID=1000
            - TZ=${TIMEZONE}
        volumes:
            - ${MEDIABOX_PATH}/sonarr:/config
            - /media/HDD/Media/tv_shows:/tv
            - /media/HDD/downloads:/downloads
        ports:
            - 8989:8989
        restart: unless-stopped
        networks:
            - mediabox

    radarr:
        image: ghcr.io/linuxserver/radarr:latest
        container_name: radarr
        environment:
            - PUID=1000
            - PGID=1000
            - TZ=${TIMEZONE}
        volumes:
            - ${MEDIABOX_PATH}/radarr:/config
            - /media/HDD/Media/movies:/movies
            - /media/HDD/downloads:/downloads
        ports:
            - 7878:7878
        restart: unless-stopped
        networks:
            - mediabox

    bazarr:
        image: ghcr.io/linuxserver/bazarr:latest
        container_name: bazarr
        environment:
            - PUID=1000
            - PGID=1000
            - TZ=${TIMEZONE}
        volumes:
            - ${MEDIABOX_PATH}/bazarr:/config
            - /media/HDD/Media/movies:/movies
            - /media/HDD/Media/tv_shows:/tv
        ports:
            - 6767:6767
        restart: unless-stopped
        networks:
            - mediabox

    overseerr:
        image: ghcr.io/linuxserver/overseerr:latest
        container_name: overseerr
        environment:
            - PUID=1000
            - PGID=1000
            - TZ=${TIMEZONE}
        volumes:
            - ${MEDIABOX_PATH}/overseerr:/config
        ports:
            - 5055:5055
        restart: unless-stopped
        networks:
            - mediabox

    plex:
        image: ghcr.io/linuxserver/plex:latest
        container_name: plex
        network_mode: host
        environment:
            - PUID=1000
            - PGID=1000
            - VERSION=docker
            - PLEX_CLAIM=claim-W5WTiks9n28nFUrXmiFx
            - TZ=${TIMEZONE}
        volumes:
            - ${MEDIABOX_PATH}/plex:/config
            - /media/HDD/Media/tv_shows:/tv
            - /media/HDD/Media/movies:/movies
        ports:
            - 5055:5055
        restart: unless-stopped

    homeassistant:
        container_name: homeassistant
        image: "ghcr.io/home-assistant/home-assistant:stable"
        volumes:
            - ${MEDIABOX_PATH}/homeassistant:/config
            - /etc/localtime:/etc/localtime:ro
        restart: unless-stopped
        privileged: true
        network_mode: host

    glances:
        image: nicolargo/glances:latest-alpine
        container_name: glances
        restart: unless-stopped
        pid: host
        ports:
            - '61208:61208'
        environment:
            - PUID=1000
            - PGID=1000
            - GLANCES_OPT=-w
            - TZ=${TIMEZONE}
        volumes:
            - ${MEDIABOX_PATH}/glances:/config
            - /var/run/docker.sock:/var/run/docker.sock:ro
        networks:
            - mediabox

    muximux:
        image: lscr.io/linuxserver/muximux:latest
        container_name: muximux
        restart: unless-stopped
        ports:
            - '8080:80'
        environment:
            - PUID=1000
            - PGID=1000
            - TZ=${TIMEZONE}
        volumes:
            - ${MEDIABOX_PATH}/muximux:/config
        networks:
            - mediabox

    duckdns:
        image: lscr.io/linuxserver/duckdns:latest
        container_name: duckdns
        environment:
            - PUID=1000
            - PGID=1000
            - SUBDOMAINS=capzulu
            - TOKEN=e87b360a-cabc-41c9-84b4-bc87f96cc850
            - LOG_FILE=false
            - TZ=${TIMEZONE}
        volumes:
            - ${MEDIABOX_PATH}/duckdns/config:/config
        restart: unless-stopped
        networks:
            - mediabox

    swag:
        image: lscr.io/linuxserver/swag:latest
        container_name: swag
        cap_add:
            - NET_ADMIN
        environment:
            - PUID=1000
            - PGID=1000
            - URL=capzulu.duckdns.org
            - VALIDATION=duckdns
            - SUBDOMAINS=wildcard
            - DUCKDNSTOKEN=e87b360a-cabc-41c9-84b4-bc87f96cc850
            - TZ=${TIMEZONE}
        volumes:
            - ${MEDIABOX_PATH}/swag:/config
        ports:
            - 443:443
        networks:
            - mediabox
        restart: unless-stopped

    deluge:
        image: lscr.io/linuxserver/deluge:latest
        container_name: deluge
        environment:
            - PUID=1000
            - PGID=1000
            - TZ=${TIMEZONE}
        volumes:
            - ${MEDIABOX_PATH}/deluge:/config
            - /media/HDD/downloads:/downloads
        ports:
            - 8112:8112
            - 6881:6881
            - 6881:6881/udp
        restart: unless-stopped
        networks:
            - mediabox

    prowlarr:
        image: lscr.io/linuxserver/prowlarr:develop
        container_name: prowlarr
        environment:
            - PUID=1000
            - PGID=1000
            - TZ=${TIMEZONE}
        volumes:
            - ${MEDIABOX_PATH}/prowlarr:/config
        ports:
            - 9696:9696
        restart: unless-stopped
        networks:
            - mediabox

    flaresolverr:
        image: ghcr.io/flaresolverr/flaresolverr:latest
        container_name: flaresolverr
        ports:
            - "8191:8191"
        environment:
            - TZ=${TIMEZONE}
        restart: unless-stopped
        networks:
            - mediabox

    watchtower:
        image: containrrr/watchtower:latest
        container_name: watchtower
        environment:
            - TZ=${TIMEZONE}
        volumes:
            - /var/run/docker.sock:/var/run/docker.sock
        restart: unless-stopped
        networks:
            - mediabox

networks:
  mediabox:
    name: mediabox
    driver: bridge
    driver_opts:
        com.docker.network.enable_ipv6: "false"
    ipam:
     config:
       - subnet: 172.23.0.0/16
         gateway: 172.23.0.1
