---
- name: Deploy media server
  hosts: all
  roles:
    - dependencies
    - k3s
    - cloudflared
    - adguard-home
    - services

    # - include_tasks: helm.yml

    # - name: Download cert-manager manifest to the cluster.
    #   ansible.builtin.get_url:
    #     url: https://github.com/cert-manager/cert-manager/releases/download/v1.13.1/cert-manager.yaml
    #     dest: /tmp/cert-manager.yml
    #     mode: '0664'

    # - name: Apply cert-manager manifest to the cluster.
    #   kubernetes.core.k8s:
    #     state: present
    #     src: /tmp/cert-manager.yml

    # - name: Delete cert-manager manifest file
    #   file:
    #     state: absent
    #     path: /tmp/cert-manager.yml

    # - name: Copy cloudflare_secret.yml to remote server
    #   copy:
    #     src: cloudflare_secret.yml
    #     dest: /tmp/cloudflare_secret.yml

    # - name: Apply cloudflare_secret manifest to the cluster.
    #   kubernetes.core.k8s:
    #     state: present
    #     src: /tmp/cloudflare_secret.yml

    # - name: Delete cloudflare_secret.yml file
    #   file:
    #     state: absent
    #     path: /tmp/cloudflare_secret.yml

    # - name: Copy cluster-issuer.yml to remote server
    #   copy:
    #     src: cluster-issuer.yml
    #     dest: /tmp/cluster-issuer.yml

    # - name: Apply cluster-issuer manifest to the cluster.
    #   kubernetes.core.k8s:
    #     state: present
    #     src: /tmp/cluster-issuer.yml

    # - name: Delete cluster-issuer.yml file
    #   file:
    #     state: absent
    #     path: /tmp/cluster-issuer.yml
